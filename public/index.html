<!DOCTYPE html>
<html>

<head>
	<title>CollaboWriter</title>
	<link href='http://fonts.googleapis.com/css?family=Special+Elite' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="css/style.css">
</head>

<body>
	<textarea id="pad" autofocus="">Connecting...</textarea>
	<button id="get-version-btn">Get version</button>
	<script src="js/sharejs/text.js"></script>
	<script src="js/sharejs/share.uncompressed.js"></script>
	<script>
		var pad = document.getElementById('pad');
			
		var socket = new WebSocket('ws://' + window.location.host);
		var sharejs = new window.sharejs.Connection(socket);

		var doc = sharejs.get('masterpieces', 'first draft');
		doc.subscribe();

		doc.whenReady(function () {
			if (!doc.type) doc.create('json0');
			if (doc.type && doc.type.name === 'json0') {

				if (!doc.snapshot) {
					var context = doc.createContext();
					var myObject = {
						text: "Enter some text here..."
					};
					context.set(myObject);
				}
				doc.attachTextarea(pad);
				doc.on('get version', function (msg) {
					var text = msg.data.text;
					console.log('version [' + msg.v + ']: ' + text);
					pad.value = text;
				});
			}
		});

		var version = doc.version;
		document.getElementById('get-version-btn').addEventListener('click', function () {
			if (pad.readOnly) {
					pad.removeAttribute('readonly');	
					doc.getSnapshotAtRevision(doc.version);
			} else {
					pad.readOnly = true;
					if (doc.version > 2) {
						doc.getSnapshotAtRevision(doc.version - 2);
					}
			}
		});
	</script>
</body>

</html>
