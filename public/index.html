<!DOCTYPE html>
<html>

<head>
	<title>CollaboWriter</title>
	<link href='http://fonts.googleapis.com/css?family=Special+Elite' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="css/style.css">
</head>

<body>
	<textarea id="pad" autofocus="">Connecting...</textarea>
	<script src="js/sharejs/text.js"></script>
	<script src="js/sharejs/share.uncompressed.js"></script>
	<script>
		var socket = new WebSocket('ws://' + window.location.host);
		var sharejs = new window.sharejs.Connection(socket);

		var doc = sharejs.get('json_test', 'test_doc_1');
		doc.subscribe();

		doc.whenReady(function () {			
			if (!doc.type) doc.create('json0');
			if (doc.type && doc.type.name === 'json0') {				
				if (doc.created) {
					var context = doc.createContext();
					var myObject = {text: "some text"};
					context.set(myObject);
				}
			}
			var pad = document.getElementById('pad');
			doc.attachTextarea(pad);
		});

		setInterval(function () {
			doc.getSnapshotAtRevision(doc.version - 2);
		}, 2000);
	</script>
</body>

</html>
